#include <efi.h>
#include <efilib.h>

EFI_STATUS efi_main(EFI_HANDLE ImageHandle, EFI_SYSTEM_TABLE *SystemTable) {
    EFI_STATUS Status;
    EFI_GUID gEfiPxeBaseCodeProtocolGuid = EFI_PXE_BASE_CODE_PROTOCOL_GUID;
    EFI_PXE_BASE_CODE_PROTOCOL *Pxe = NULL;

    // Locate the PXE Base Code Protocol
    Status = uefi_call_wrapper(SystemTable->BootServices->LocateProtocol, 3, &gEfiPxeBaseCodeProtocolGuid, NULL, (void **)&Pxe);
    if (EFI_ERROR(Status)) {
        Print(L"PXE Base Code Protocol not found\n");
        return Status;
    }

    // Disable PXE boot
    Status = uefi_call_wrapper(Pxe->Stop, 1, Pxe);
    if (EFI_ERROR(Status)) {
        Print(L"Failed to stop PXE boot\n");
        return Status;
    }

    // Your code to disable USB boot
    // ...

    return EFI_SUCCESS;
}
